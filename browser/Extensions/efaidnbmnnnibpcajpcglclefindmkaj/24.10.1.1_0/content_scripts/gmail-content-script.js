/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{const e="acrobatContentScriptDisconnectStart",t="acrobatContentScriptDisconnectEnd",o="acrobat-icon-added",n="acrobat-listener-added";let i,c,r,a,s;const l=()=>{r?.addAcrobatTouchPointInTheMessageView(),a?.processForListView(),c?.processForAlreadyShownNativeViewerPrompt()},m=new MutationObserver((function(){s?.disconnectBodyObserver?m.disconnect():(m.takeRecords(),chrome?.runtime?.id?l():(g(),m?.disconnect()))})),d=()=>{if(s?.adobeCleanFontAdded)return;const e=chrome.runtime.getURL("browser/css/fonts/AdobeClean-Regular.otf"),t=new FontFace("AdobeClean-Regular",`url(${e})`);t.load().then((()=>{document.fonts.add(t)})),s.adobeCleanFontAdded=!0},g=()=>{if(r?.removeAllTouchPoints(),a?.removeAllTouchPoints(),c?.removeAllTouchPoints(),document.querySelector(`img[${o}]`)){const e=document.querySelectorAll(`img[${o}]`);for(let t=0;t<e.length;t++)e[t]?.removeAttribute(o)}if(document.querySelector(`[${n}]`)){const e=document.querySelectorAll(`[${n}="Y"]`);for(let t=0;t<e.length;t++)e[t]?.setAttribute(n,"N")}},u=o=>{window.addEventListener(t,(e=>o.contentScriptDisconnectEnd(e)),{signal:o?.eventControllerSignal}),window.dispatchEvent(new Event("orphanContentScript")),window.dispatchEvent(new CustomEvent(e)),window.addEventListener(e,(()=>(e=>{if(!chrome.runtime?.id){const o=e.createStateToTransferToNewContentScript();e.contentScriptDisconnectStart(),m?.disconnect(),window.dispatchEvent(new CustomEvent(t,{detail:{state:o}}))}})(o)),{signal:o?.eventControllerSignal}),d()},h=async e=>{const t=chrome.runtime.getURL("content_scripts/gmail/state.js");s=(await import(t)).default,(e=>{s&&(s.gmailConfig=e,s.iconURL=chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png"),s.iconURLListView=chrome.runtime.getURL("browser/images/acrobat_dc_trefoil_24_white.svg"),s.viewerURLPrefix=chrome.runtime.getURL("viewer.html"))})(e),u(s);const o=chrome.runtime.getURL("content_scripts/gmail/gmail-response-service.js"),n=chrome.runtime.getURL("content_scripts/gmail/native-viewer-touch-point-service.js"),l=chrome.runtime.getURL("content_scripts/gmail/message-view-touch-point-service.js"),m=chrome.runtime.getURL("content_scripts/gmail/list-view-touch-point-service.js");return Promise.all([import(o),import(n),import(l),import(m)]).then((e=>{i=e[0],c=e[1],r=e[2],a=e[3]}))};chrome.runtime.onMessage.addListener((function(e){"acrobatGsuiteTouchPointsDisabled"===e.content_op&&(m?.disconnect(),g(),s?.disconnectEventListeners())})),window.location?.search?.includes("acrobatPromotionSource")||chrome.runtime?.sendMessage({main_op:"gmail-init"},(e=>{e.touchPointSettingEnabled&&(e.enableAttachmentCardPromptInGmail||window.location?.search?.includes("enableAcrobatPromptInGmail"))&&h(e).then((()=>{(e=>{s.fteToolTip={lastGmailFteShown:{type:""}};const t=(new Date).getTime(),o={enableFte:e,count:0,nextDate:t};chrome.storage.local.get("acrobat-gmail-fte-config",(n=>{if(n?.["acrobat-gmail-fte-config"]){let o=n["acrobat-gmail-fte-config"];s.fteToolTip.touchPointClicked=o?.touchPointClicked,o.enableFte=e;const i=s?.gmailConfig?.gmailFteToolTipConfig?.tooltip;o?.count>i?.resetDay&&i?.resetDay>0&&(o.count=0,o.nextDate=t),chrome.storage.local.set({"acrobat-gmail-fte-config":o})}else chrome.storage.local.set({"acrobat-gmail-fte-config":o})}))})(e?.enableGmailFteToolTip),g(),l(),(()=>{try{const e={childList:!0,subtree:!0};m.observe(document.body,e)}catch(e){}})()}))}))})();