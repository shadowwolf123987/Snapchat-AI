/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{const e="-shared",t="acrobatDisconnectContentScriptStart",n="acrobatContentScriptDisconnectEnd",o="acrobat-prompt";let r,a,i,c=!1,s=new AbortController,d={addedAdobeCleanFont:!1};const l=()=>!chrome.runtime?.id,m=()=>window.location.pathname.includes("/file"),u=e=>{try{chrome.runtime.sendMessage({main_op:"analytics",analytics:e})}catch(e){}},p=(new Set,t=>{if(c||t){const t=document.getElementsByClassName(o);t?.length>0&&t[0].remove();const n=document.getElementsByClassName(o+e);n?.length>0&&n[0].remove();const r=document.getElementById("acrobat-prompt");r?.remove(),c=!1}}),w=(e,t)=>{if(e){const n=r?.selectors,o=n&&n[t];for(let t=0;t<o?.length;t++){let n=e.querySelector(o[t]);if(n)return n}}return null},h=()=>w(document,"fileDetails"),g=e=>{try{return JSON.parse(e?.textContent?.replace(/\\/g,""))}catch(e){return null}};let b="0";const v=()=>{const t=document.createElement("div"),n=(()=>{const e=document.createElement("img");e.setAttribute("src",chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png"));const t=m()?"acrobat-icon-shared":"acrobat-icon";return e.setAttribute("class",t),e})(),a=(()=>{const e=document.createElement("span"),t=m()?"acrobat-prompt-text-shared":"acrobat-prompt-text";return e.setAttribute("class",t),e.textContent=r?.acrobatPromptText||"Edit with Acrobat",e})(),i=(()=>{const e=document.createElement("div"),t=m()?"acrobat-prompt-tooltip":"acrobat-prompt-tooltip-shared";return e.setAttribute("class",t),e.textContent=r?.acrobatPromptText||"Open in Acrobat",e})(),c=m()?o+e:o;return t.setAttribute("class",c),t.appendChild(n),t.appendChild(i),t.appendChild(a),t.addEventListener("click",(()=>(()=>{if(l())return void p();const e=h(),t=g(e);u([["DCBrowserExt:Gdrive:OpenInExtension:Clicked"]]);const n=chrome.runtime.getURL("viewer.html")+"?pdfurl="+encodeURIComponent(`https://drive.usercontent.google.com/download?id=${t.id}&authuser=${b}&acrobatPromotionSource=GoogleDriveNativeView`)+"&pdffilename="+encodeURIComponent(t.title);window.open(n,"_blank")})()),{signal:s.signal}),t},f=()=>{try{if(c)return;const e=v(),t=(()=>{let e;for(let t=0;t<r?.selectors?.promptParentElement.length&&(e=document.querySelector(r?.selectors?.promptParentElement[t]),!e);t++);return e})();t?(t.prepend(e),c=!0,window.innerWidth>1080&&u([["DCBrowserExt:Gdrive:OpenInExtension:Shown"]])):p()}catch(e){p()}},C=()=>{const e=h();if(e){"application/pdf"===g(e).mimeType?f():p()}else p()},E=()=>{p(!0)},x=()=>{l()&&(i&&i.disconnect(),p(),s.abort(),window.dispatchEvent(new CustomEvent(n,{detail:{state:d}})))},y=()=>{window.addEventListener(n,(e=>(e=>{l()||(d=e.detail.state)})(e)),{signal:d?.eventControllerSignal}),window.dispatchEvent(new Event("orphanContentScript")),window.dispatchEvent(new Event(t)),window.addEventListener(t,x,{signal:s.signal}),chrome.runtime.sendMessage({main_op:"gdrive-init"},(e=>{(e.enableOpenInExtension||window.location?.search?.includes("enableAcrobatPromptInGSuite"))&&(u([["DCBrowserExt:Gdrive:OpenInExtension:Enable"]]),r=e,(()=>{if(window?.document?.location?.pathname.includes("/u/"))return void(b=window.document.location.pathname.split("/")[3]);const e=document.createElement("script");document.addEventListener("acrobat-auth-user-id",(t=>{b=t?.detail?.authuser,e.remove()})),e.type="text/javascript",e.src=chrome.runtime.getURL("content_scripts/gdrive/get-auth-user.js"),document.head.appendChild(e)})(),a=chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png"),(()=>{if(!d?.adobeCleanFontAdded){const e=chrome.runtime.getURL("browser/css/fonts/AdobeClean-Regular.otf"),t=new FontFace("AdobeClean-Regular",`url(${e})`);t.load().then((()=>{document.fonts.add(t)})),d.adobeCleanFontAdded=!0}})(),E(),C(),(()=>{try{const e={childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]};i=new MutationObserver((function(){i.takeRecords(),l()?(i.disconnect(),p()):C()})),i.observe(document.body,e)}catch(e){}})())}))};chrome.runtime.onMessage.addListener((function(e){"acrobatGsuiteTouchPointsDisabled"===e.content_op&&(i?.disconnect(),E())})),chrome.storage.local.get("acrobat-gsuite-touch-points",(e=>{"false"!==e["acrobat-gsuite-touch-points"]&&("drive.google.com"===window?.document?.location?.host&&window.top===window.self&&0===window?.document?.location?.ancestorOrigins.length?y():"drive.usercontent.google.com"===window?.document?.location?.host&&window.top===window.self&&0===window?.document?.location?.ancestorOrigins.length&&(()=>{const e=new URLSearchParams(window.location.search);e?.has("acrobatPromotionSource")&&!e?.has("uuid")&&chrome.runtime.sendMessage({main_op:"gdrive-download-init"},(e=>{r=e;const t=w(document,"confirmInput")?.value,n=w(document,"atInput")?.value,o=w(document,"uuidInput")?.value,a=w(document,"fileName");let i=`${window.location.href}&confirm=${t}&at=${n}&uuid=${o}`,c=chrome.runtime.getURL("viewer.html")+"?pdfurl="+encodeURIComponent(i);a?.textContent&&(c=c+"&pdffilename="+encodeURIComponent(a?.textContent)),u([["DCBrowserExt:GdriveDPage:Redirect"]]),window.location.replace(c)}))})())}))})();